<!doctype html><html lang=en><head><title>Deprecation Done Right ::
Tentacles — Eating the world; one squid, post and package at a time.</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="There&amp;rsquo;s nothing quite like the feeling of releasing a new major version of your library. Ahh, that new package smell.
Then, the problem: *deprecation. The old version included a hard-to-use, overcomplicated API. In retrospect, you were rushing to release the first version, so you glossed over it.
So, how do we deprecate an API? Should you&amp;hellip;
 Remove the API immediately? #DontCare Replace the API with a stub that throws a runtime error?"><meta name=keywords content="privacy,technology,security"><meta name=robots content="noodp"><link rel=canonical href=/posts/deprecation-done-right./><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/img/favicon.png><link href=/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="Deprecation Done Right"><meta name=twitter:description content="The elegance of annoyance."><meta property="og:title" content="Deprecation Done Right"><meta property="og:description" content="The elegance of annoyance."><meta property="og:type" content="article"><meta property="og:url" content="/posts/deprecation-done-right./"><meta property="article:published_time" content="2020-01-23T00:00:00+00:00"><meta property="article:modified_time" content="2020-01-23T00:00:00+00:00"><meta property="og:site_name" content="Tentacles"></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg></span><span class=logo__text>tentacles.dev</span>
<span class=logo__cursor></span></a><span class=header__right><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/about>About</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/about>About</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>Deprecation Done Right</h1><div class=post-meta><span class=post-date>2020-01-23</span>
<span class=post-author>— Written by Tentacles</span></div><div class=post-content><p>There&rsquo;s nothing quite like the feeling of releasing a new major version of your library. Ahh, that new package smell.</p><p>Then, the problem: *<em>deprecation</em>. The old version included a hard-to-use, overcomplicated API. In retrospect, you were rushing to release the first version, so you glossed over it.</p><p>So, how <em>do</em> we deprecate an API? Should you&mldr;</p><ul><li>Remove the API immediately? #DontCare</li><li>Replace the API with a stub that throws a runtime error?</li><li>Log a warning to the console upon invocation?</li></ul><p>This all depends on how your application is released. Some libraries like React gradually deprecate functions, by incrementally adding warnings, stubs, and fake return values (after 2 releases).</p><p>If your package is geared around a stable API, you probably shouldn&rsquo;t immediately drop an API. In some cases, the best way to remove an API is to leave it in.</p><p>Another method would be to change the <em>naming scheme</em> of deprecated functions. In React, most unstable / outdated API names are prefixed with <code>UNSAFE_</code>. This gives consumers a friendly warning that they probably shouldn&rsquo;t be using this API!</p><p>So, to answer the main question, you need to decide <em>how</em> to manage deprecation for your library. If it&rsquo;s a high-profile FOSS project, you&rsquo;ll most likely want to gradually deprecate functions. This leads to less issues (I mean that in both the literal and Git-forge sense).</p><p>Anyway, the way I do it in JavaScript is with a little function. Start small:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>deprecate</span> (<span style=color:#a6e22e>func</span>, <span style=color:#a6e22e>replacement</span>, <span style=color:#a6e22e>funcName</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>func</span>.<span style=color:#a6e22e>name</span>) {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>message</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>funcName</span><span style=color:#e6db74>}</span><span style=color:#e6db74> is deprecated!</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>replacement</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>` Please use </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>replacement</span><span style=color:#e6db74>}</span><span style=color:#e6db74> instead.`</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>;
  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>isFirstInvocation</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>function</span> (...<span style=color:#a6e22e>args</span>) {
     <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isFirstInvocation</span>) {
       <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>warn</span>(<span style=color:#a6e22e>message</span>);
       <span style=color:#a6e22e>isFirstInvocation</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
     }
     
     <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>func</span>.<span style=color:#a6e22e>apply</span>(<span style=color:#66d9ef>this</span>, <span style=color:#a6e22e>args</span>);
   }
}
</code></pre></div><p>That&rsquo;s the whole thing. Basically, on the first invocation of the function, we log a deprecation message to the console. After that, no warning is printed. This means the developer console won&rsquo;t be bombarded with deprecation warnings.</p><blockquote><p>Written with <a href=https://stackedit.io/>StackEdit</a>.</p></blockquote><blockquote></blockquote></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=/posts/the-dangers-behind-oauth.md/><span class=button__text>The Dangers Behind OAuth</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user">Tentacles 2021</div></div></footer><script src=/assets/main.js></script><script src=/assets/prism.js></script></div></body></html>